<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up | Elnathan</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: glowingBorder 2s infinite alternate;
        }

        @keyframes glowingBorder {
            from {
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.2),
                    0 0 20px rgba(255, 255, 255, 0.2),
                    0 0 30px rgba(255, 255, 255, 0.2);
            }

            to {
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.4),
                    0 0 40px rgba(255, 255, 255, 0.4),
                    0 0 60px rgba(255, 255, 255, 0.4);
            }
        }

        .datetime-info {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        h2 {
            color: #fff;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #fff;
            font-size: 0.9em;
            font-weight: 500;
        }

        input,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            border-color: #fff;
            outline: none;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
        }

        select option {
            background: #000;
            color: #fff;
        }

        button {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid #fff;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .message {
            display: none;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            color: #fff;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        .account-links {
            margin-top: 20px;
            text-align: center;
        }

        .account-links a {
            color: #fff;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s ease;
            opacity: 0.8;
            display: inline-block;
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .account-links a:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="datetime-info" id="currentDateTime">
            Current Date and Time (UTC - YYYY-MM-DD HH:MM:SS formatted): 2025-01-28 18:06:23
        </div>
        <div class="datetime-info">
            Current User's Login: elnathanwebsite
        </div>

        <h2>Sign Up</h2>
        <form id="signupForm">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" required placeholder="Enter your username">
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" required placeholder="Enter your email">
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" required placeholder="Enter your password">
            </div>

            <div class="form-group">
                <label for="activity">Activity Status</label>
                <select id="activity" required>
                    <option value="">Select your activity</option>
                    <option value="student">Pelajar</option>
                    <option value="unemployed">Pengangguran</option>
                    <option value="college">Mahasiswa</option>
                </select>
            </div>

            <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" required>
                    <option value="">Select your gender</option>
                    <option value="male">Pria</option>
                    <option value="female">Wanita</option>
                    <option value="transgender">Transgender</option>
                </select>
            </div>

            <div class="form-group">
                <label for="age">Age</label>
                <input type="number" id="age" required min="1" max="150" placeholder="Enter your age">
            </div>

            <button type="submit">Sign Up</button>
            <div id="message" class="message"></div>
        </form>

        <div class="account-links">
            <a href="login.html">I Have Account</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDd8glQvhs-IvOMj6LRpJo1vYQi40DPCqM",
            authDomain: "ethan-el-nathan.firebaseapp.com",
            databaseURL: "https://ethan-el-nathan-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ethan-el-nathan",
            storageBucket: "ethan-el-nathan.firebasestorage.app",
            messagingSenderId: "1079423989695",
            appId: "1:1079423989695:web:9d94b8aaf4b8b692d9130a",
            measurementId: "G-ED78MWFGRP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        function updateDateTime() {
            const now = new Date();
            const formatted = now.toISOString().replace('T', ' ').substr(0, 19);
            document.getElementById('currentDateTime').textContent =
                `Current Date and Time (UTC - YYYY-MM-DD HH:MM:SS formatted): ${formatted}`;
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const userData = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                activity: document.getElementById('activity').value,
                gender: document.getElementById('gender').value,
                age: parseInt(document.getElementById('age').value),
                registrationDate: new Date().toISOString().replace('T', ' ').substr(0, 19),
                createdBy: 'elnathanwebsite'
            };

            const password = document.getElementById('password').value;
            const messageElement = document.getElementById('message');

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, userData.email, password);
                userData.uid = userCredential.user.uid;

                await set(ref(database, 'users/' + userData.uid), userData);

                messageElement.textContent = 'Registration successful!';
                messageElement.className = 'message success-message';
                messageElement.style.display = 'block';

                document.getElementById('signupForm').reset();
                setTimeout(() => {
                    window.location.href = `login.html?username=${encodeURIComponent(userData.username)}`;
                }, 2000);

            } catch (error) {
                console.error("Error: ", error);
                messageElement.textContent = error.message;
                messageElement.className = 'message error-message';
                messageElement.style.display = 'block';
            }
        });
        // Tambahkan fungsi untuk menyimpan di localStorage
        function saveToLocalStorage(userData, password) {
            localStorage.setItem('username', userData.username);
            localStorage.setItem('email', userData.email);
            localStorage.setItem('password', password); // Perhatian: menyimpan password di localStorage tidak aman
            localStorage.setItem('activity', userData.activity);
            localStorage.setItem('gender', userData.gender);
            localStorage.setItem('age', userData.age);
            localStorage.setItem('registrationDate', userData.registrationDate);
            localStorage.setItem('uid', userData.uid);
        }

        // Modifikasi event listener form submission
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const userData = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                activity: document.getElementById('activity').value,
                gender: document.getElementById('gender').value,
                age: parseInt(document.getElementById('age').value),
                registrationDate: new Date().toISOString().replace('T', ' ').substr(0, 19),
                createdBy: 'elnathanwebsite'
            };

            const password = document.getElementById('password').value;
            const messageElement = document.getElementById('message');

            try {
                // Create user in Firebase Authentication
                const userCredential = await createUserWithEmailAndPassword(auth, userData.email, password);
                userData.uid = userCredential.user.uid;

                // Store in Firebase Database
                await set(ref(database, 'users/' + userData.uid), userData);

                // Store in localStorage
                saveToLocalStorage(userData, password);

                // Show success message
                messageElement.textContent = 'Registration successful! Data saved both in Firebase and locally.';
                messageElement.className = 'message success-message';
                messageElement.style.display = 'block';

                // Reset form and redirect
                document.getElementById('signupForm').reset();

                // Tambahkan timeout lebih lama agar pesan dapat dibaca
                setTimeout(() => {
                    window.location.href = `login.html?username=${encodeURIComponent(userData.username)}`;
                }, 2000);

            } catch (error) {
                console.error("Error: ", error);
                messageElement.textContent = error.message;
                messageElement.className = 'message error-message';
                messageElement.style.display = 'block';

                // Jika gagal menyimpan di Firebase, coba simpan di localStorage saja
                try {
                    saveToLocalStorage(userData, password);
                    messageElement.textContent += ' But data saved locally.';
                } catch (localError) {
                    console.error("Local Storage Error: ", localError);
                }
            }
        });

        // Tambahkan fungsi untuk mengecek data yang tersimpan di localStorage saat halaman dimuat
        window.onload = function () {
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // Cek apakah ada data user yang tersimpan
            const savedUsername = localStorage.getItem('username');
            if (savedUsername) {
                console.log('Data found in localStorage for user:', savedUsername);
            }
        };

        // Tambahkan fungsi untuk membersihkan localStorage (optional, untuk testing)
        function clearLocalStorage() {
            localStorage.clear();
            console.log('Local storage cleared');
        }
    </script>
</body>

</html>